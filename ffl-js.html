<head><meta name="viewport" content="width=device-width, initial-scale=1.0"></head>
<body>
  <!-- layout -->
  <div id="top-content">
    <h3>calling into ffl wasm from js (real)</h3>
    <form id="charform">
      <label for="charinfo">CharInfo Base64 Data:</label>
      <input type="text" id="charinfo" value="AAAAAAkAAAAAAAAAAAAAAAAAAABlAAAARAAAgAAAAAAhAAAASQAAgAcAAAADAAAABAAAAAIAAAAQAAAAEgAAAEEAAIAIAAAAAwAAAAMAAAAMAAAABAAAAAAAAAAAAAAACwAAABcAAAATAACAAAAAAAMAAAANAAAAAAAAAAAAAAAIAACABAAAAAoAAAAEAAAARAAAgAYAAAAMAAAAAAAAAAQAAAACAAAAFAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
      <br>
      or, choose you're fighter...
      <div style="display: flex; gap: 6px; height: 150px">
        <!-- template for buttons -->
        <div id="btn-template" style="display: none;"><button onclick="onItemClick(event)" style="display: inline-block; margin-right: 10px;"><img data-src="https://mii-unsecure.ariankordi.net/miis/image.png?shaderType=switch&amp;type=variableiconbody&amp;width=96&amp;texResolution=128&amp;resourceType=low&amp;scale=1&amp;data=" width="128"><div>template</div></button></div>
        <!-- define buttons here -->
        <meta data-name="jasmine" data-data="AwAAQKBBOMSghAAA27iHMb5gKyoqQgAAWS1KAGEAcwBtAGkAbgBlAAAAAAAAABw3EhB7ASFuQxwNZMcYAAgegg0AMEGzW4JtAABvAHMAaQBnAG8AbgBhAGwAAAAAAJA6">
        <meta data-name="soyun" data-data="000f160e146467674d564d551b1f1e1326293037454c565e212e3144070e7279848b908b8fa3aac4d0d7dee5ecf3ff">
        <meta data-name="charline" data-data="AwAFMG0rAiKJRLe1nDWwN5i26X5uuAAAY0FjAGgAYQByAGwAaQBuAGUAAAAAAEwmApBlBttoRBggNEYUgRITYg0AACkAUkhQYwBoAGEAcgBsAGkAbgBlAAAAAAAAAHLb">
        <meta data-name="bro mole high" data-data="0402400431040402020b030a0604060208070906020100140402080200394004010c160213040d0f03020a060d09">
        <details><summary>ugly only for test</summary>
          <meta data-name="Aiueome" data-data="AwEAMAAAAAAAAAAA2sZrOqTA4fgk3wAAABBBAGkAdQBlAG8AbQBlAAAAAAAAAH9/JwAuCXPOgxfsCIUfDyUY0GUAO0K2oxFSAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGUq">
          <meta data-name="Zluuuue" data-data="32037f040d0507060c0003620a08120903000301040500320711096100227f05010818031308080e050300000200">
        </details>
      </div>


      <button type="submit">Load CharModel</button>
    </form>

    <div id="texture-display" style="overflow-y: scroll; height: 250px"></div>

  </div>
  <!-- end layout -->

  <!-- emscripten module (not modularized) -->
  <!-- async here basically guarantees our script loads before this -->
  <script async src="https://debian.local:8445/assets/web%20builds/build-em/ffl-emscripten.js"></script>
  <!-- path to FFL resource file (FFLResHigh.dat, AFLResHigh_2_3.dat, etc.) -->
  <meta itemprop="ffl-resource-fetch-path" content="https://debian.local:8445/assets/web%20builds/FFLResHigh.dat">

  <!-- three.js 0.137.5 from 2022 -->
  <script src="https://unpkg.com/three@0.137.5/build/three.min.js"></script>
  <!-- Include GLTFLoader, OrbitControls -->
  <!--<script src="https://unpkg.com/three@0.137.5/examples/js/loaders/GLTFLoader.js"></script>-->
  <script src="https://unpkg.com/three@0.137.5/examples/js/controls/OrbitControls.js"></script>

  <script src="struct-fu-mini.js"></script>
  <script src="FFLShaderMaterial.js"></script>
  <!-- Include ffl.js after three.js and FFLShaderMaterial.js. -->
  <script src="ffl.js"></script>

  <!-- for character chooser buttons -->
  <script>
  document.querySelectorAll('[data-name][data-data]').forEach(el => {
    const clone = document.getElementById('btn-template').cloneNode(true);
    clone.style.display = '';

    const btn = clone.querySelector('button');
    const img = btn.querySelector('img');
    const div = btn.querySelector('div');

    const data = el.getAttribute('data-data-icon') || el.getAttribute('data-data');
    img.setAttribute('src', img.getAttribute('data-src') + encodeURIComponent(data));
    btn.setAttribute('data-data', el.getAttribute('data-data'));
    div.textContent = el.getAttribute('data-name');

    el.replaceWith(clone);
  });

  const charForm = document.getElementById('charform');
  const charInfoInput = document.getElementById('charinfo');
  function onItemClick(e) {
    e.preventDefault();
    const data = e.currentTarget.getAttribute('data-data');
    console.log('clicked: ', data);
    //if (!isInitialized) {
      charInfoInput.value = data;
      charform.dispatchEvent(new Event('submit'));
    //} else {
    //  updateCharModelInScene(data);
    //}
  }
  </script>
</body>
